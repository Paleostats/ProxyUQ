# Proxy Uncertainty Quantification - ProxyUQ

[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![NSF-1928366](https://img.shields.io/badge/NSF-1928366-blue.svg)](https://nsf.gov/awardsearch/showAward?AWD_ID=1928366)

This repository contains files designed to read in and analyze `.out` files generated by the chronology modelling software Bacon ([Blaauw & Christen, 2011]()) and Plum ([Aquino-López *et al*., 2018](https://doi.org/10.1007/s13253-018-0328-7)). The program reads in the posterior accumulation rates from the chronology (in the `.out` file) and then estimates proxy values, with uncertainty, for each posterior run of the chronology.

The function `ProxyUQ()` returns a `dict` object which can be saved to file.  The object contains:

* dates along a user defined time step, based on the posterior draws from the Bacon or Plum age model
* proxy estimates drawn from an MCMC sampling process for each of the user-defined proxies contained in the `_proxy.txt` file.

A user may request to save the `dict` to a JSON formatted file using the `saveFile` parameter, and may request to save plots to output using the `plotProxy` parameter.

## References

* Aquino-López, M.A., Blaauw, M., Christen, J.A. et al. 2018. Bayesian Analysis of 210Pb Dating. *Journal of Agricultural, Biological and Environmental Statistics*. 23, 317–333. https://doi.org/10.1007/s13253-018-0328-7
* Blaauw, M., and Christen, J. A. 2011. Flexible paleoclimate age-depth models using an autoregressive gamma process. *Bayesian Analysis*, 6(3), 457–474.

## Contributors

This project is an open project, and contributions are welcome from any individual.  All contributors to this project are bound by a [code of conduct](CODE_OF_CONDUCT.md).  Please review and follow this code of conduct as part of your contribution.

* [Marco A. Aquino-López](http://example.com/contributor_url1) [![orcid](https://img.shields.io/badge/orcid-0000--0002--5076--7205-brightgreen.svg)](https://orcid.org/0000-0002-5076-7205)
* [J Andrés Christen](http://example.com/contributor_url2) [![orcid](https://img.shields.io/badge/orcid-0000--0002--5795--4345-brightgreen.svg)](https://orcid.org/0000-0002-5795-4345)
* [Socorro Dominguez](https://sedv8808.github.io/) [![orcid](https://img.shields.io/badge/orcid-0000--0002--7926--4935-brightgreen.svg)](https://orcid.org/0000-0002-7926-4935)
* [Simon Goring](http://goring.com) [![orcid](https://img.shields.io/badge/orcid-0000--0002--2700--4605-brightgreen.svg)](https://orcid.org/0000-0002-2700-4605)

### Tips for Contributing

Issues and bug reports are always welcome.  Code clean-up, and feature additions can be done either through pull requests to project forks or branches.

## How to use this repository

A description of the files and directory structure in the repository.

### Workflow Overview

This project requires the use of existing output from Bacon or Plum, which consists of the following files.  For a given core (e.g., "MyCore") there should be the following:

* `MyCore.out` -- The posterior estimates
* `MyCore_settings.txt` -- The settings used to construct the chronology
* `MyCore_proxies.csv` -- A comma separated file used to report proxy data within the core, defined when Bacon or Plum are initially run.

In addition, if the user wishes to return the output JSON file or the plots they must make sure that they have sufficient rights to save to the desired folder.

The script runs using the command:

```Python
aa = ProxyUQ( core = "LL14", folder = "AtmosphericRivers", p_list=[1], saveFile="myjson.json")
```

Where we assume the files associated with the core `LL14` are in a folder `./AtmosphericRivers` on the users' computer.  We plot the second proxy (Python starts counting at 0, so `p_list = [1]` means the second column) within the `LL14_proxies.csv` file, in this case, `S/Ti`:

```csv
Corrected core depth (cm), S/Ti,  Ti/K, Zr/Fe, Al/Si, Zr/Rb, Si/Ti
                        5,  211, 0.474, 0.556,      , 0.065,  71.7
                        6,  180, 0.433, 3.667, 0.259, 0.394,  62.8
```

To select more proxies for analysis the user can change the value passed to `p_list`, for example, `p_list = [1, 2, 3]` will generate posteriors for all of S/Ti, Ti/K and Zr/Fe.

### System Requirements

This project is developed using Python.

### Key Outputs

This project generates a JSON file with the following structure:

```json
{
    "dates": [
        [-69.0, -59.0, -49.0, -39.0]
    ],
    "proxy": {
        "S/Ti": [
            [NaN, NaN, 17692, 22595],
            . . .,
            [19342, 20124, 17989, 21595]
        ]
    }
}
```

The `proxy` key in the JSON file is an object which contains a key-value pair for each proxy selected by the user.  Each proxy within `proxy` contains a list of lists.  Each of these represents a posterior draw of the proxy values along the age axis.  The length of the list will be equivalent to the number of posteriors within the `.out` file.

`NaN` values are returned when the depth associated with the prior draw is outside of the range provided by the `_proxies` file.